# bot_assignment3.py
import os
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
from dotenv import load_dotenv

load_dotenv()
# –¢–æ–∫–µ–Ω –±–æ—Ç
TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")


async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    welcome_text = (
        "üëã –ü—Ä–∏–≤–µ—Ç! –Ø –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –±–æ—Ç.\n\n"
        "–Ø –∑–Ω–∞—é –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ —Å–ª–æ–≤–∞:\n"
        "‚Ä¢ *–ü–∏—Å–∞—Ç–µ–ª—å* - –≤—ã–¥–∞—Å—Ç —Ñ–∞–º–∏–ª–∏—é –ø–∏—Å–∞—Ç–µ–ª—è\n"
        "‚Ä¢ *–ü–æ—ç—Ç* - –≤—ã–¥–∞—Å—Ç —Ñ–∞–º–∏–ª–∏—é –ø–æ—ç—Ç–∞\n"
        "‚Ä¢ *–ö–Ω–∏–≥–∞* - –≤—ã–¥–∞—Å—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏\n"
        "‚Ä¢ *–ú–æ–Ω–æ–ª–æ–≥* - –≤—ã–¥–∞—Å—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–Ω–æ–ª–æ–≥–∞\n\n"
        "–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ –æ–¥–Ω–æ –∏–∑ —ç—Ç–∏—Ö —Å–ª–æ–≤!"
    )
    await update.message.reply_text(welcome_text, parse_mode='Markdown')


async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    help_text = (
        "‚ÑπÔ∏è *–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É*\n\n"
        "–ö–æ–º–∞–Ω–¥—ã:\n"
        "/start - –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ\n"
        "/help - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É\n\n"
        "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ–¥–Ω–æ –∏–∑ —Å–ª–æ–≤, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç:\n"
        "‚Ä¢ –ü–∏—Å–∞—Ç–µ–ª—å\n"
        "‚Ä¢ –ü–æ—ç—Ç\n"
        "‚Ä¢ –ö–Ω–∏–≥–∞\n"
        "‚Ä¢ –ú–æ–Ω–æ–ª–æ–≥"
    )
    await update.message.reply_text(help_text, parse_mode='Markdown')


async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π - –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ï –æ—Ç–≤–µ—Ç—ã"""
    user_message = update.message.text.strip().lower()

    # –°–ª–æ–≤–∞—Ä—å —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –∫–∞–∫ –≤ –∑–∞–¥–∞–Ω–∏–∏ 3
    fixed_responses = {
        "–ø–∏—Å–∞—Ç–µ–ª—å": "–•–µ–º–∏–Ω–≥—É—ç–π",
        "–ø–æ—ç—Ç": "–®–µ–∫—Å–ø–∏—Ä",
        "–∫–Ω–∏–≥–∞": "–¢—Ä–∏ —Ç–æ–≤–∞—Ä–∏—â–∞",
        "–º–æ–Ω–æ–ª–æ–≥": "–ë—ã—Ç—å –∏–ª–∏ –Ω–µ –±—ã—Ç—å"  # –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –¥–ª—è "–ú–æ–Ω–æ–ª–æ–≥"
    }

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –Ω–∞—à–µ–º —Å–ª–æ–≤–∞—Ä–µ
    if user_message in fixed_responses:
        # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å —ç–º–æ–¥–∑–∏ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
        if user_message == "–ø–∏—Å–∞—Ç–µ–ª—å":
            response = f"üìù –ü–∏—Å–∞—Ç–µ–ª—å: *{fixed_responses[user_message]}*"
        elif user_message == "–ø–æ—ç—Ç":
            response = f"‚úçÔ∏è –ü–æ—ç—Ç: *{fixed_responses[user_message]}*"
        elif user_message == "–∫–Ω–∏–≥–∞":
            response = f"üìñ –ö–Ω–∏–≥–∞: *{fixed_responses[user_message]}*"
        elif user_message == "–º–æ–Ω–æ–ª–æ–≥":
            response = f"üé≠ –ú–æ–Ω–æ–ª–æ–≥: *{fixed_responses[user_message]}*"
        else:
            response = fixed_responses[user_message]

        await update.message.reply_text(response, parse_mode='Markdown')
    else:
        # –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ
        error_text = (
            "‚ùå –Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.\n\n"
            "–Ø –∑–Ω–∞—é –æ—Ç–≤–µ—Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞:\n"
            "‚Ä¢ *–ü–∏—Å–∞—Ç–µ–ª—å*\n"
            "‚Ä¢ *–ü–æ—ç—Ç*\n"
            "‚Ä¢ *–ö–Ω–∏–≥–∞*\n"
            "‚Ä¢ *–ú–æ–Ω–æ–ª–æ–≥*\n\n"
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–¥–Ω–æ –∏–∑ —ç—Ç–∏—Ö —Å–ª–æ–≤ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ /help –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏."
        )
        await update.message.reply_text(error_text, parse_mode='Markdown')


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
    if not TOKEN:
        print("‚ö†Ô∏è  –í–Ω–∏–º–∞–Ω–∏–µ: –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        print("–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ —Å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º:")
        print("TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å")
        print("\n–ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥, –¥–æ–±–∞–≤–∏–≤ —Ç–æ–∫–µ–Ω –Ω–∞–ø—Ä—è–º—É—é:")
        print('TOKEN = "–í–ê–®_–¢–û–ö–ï–ù"')

        # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ç–æ–∫–µ–Ω —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        use_direct_token = input("\n–•–æ—Ç–∏—Ç–µ –≤–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω –Ω–∞–ø—Ä—è–º—É—é? (–¥–∞/–Ω–µ—Ç): ")
        if use_direct_token.lower() == '–¥–∞':
            direct_token = input("–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞: ")
            if direct_token:
                run_bot(direct_token)
            else:
                print("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –≤–≤–µ–¥–µ–Ω. –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω.")
        else:
            print("‚ùå –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
        return

    run_bot(TOKEN)


def run_bot(token):
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º"""
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    app = Application.builder().token(token).build()

    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("help", help_command))

    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    print("=" * 50)
    print("‚úÖ –ë–æ—Ç –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 3 –∑–∞–ø—É—â–µ–Ω!")
    print("=" * 50)
    print("\nüì± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:")
    print("1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Telegram")
    print("2. –ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞")
    print("3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start")
    print("4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ª–æ–≤–∞: –ü–∏—Å–∞—Ç–µ–ª—å, –ü–æ—ç—Ç, –ö–Ω–∏–≥–∞, –ú–æ–Ω–æ–ª–æ–≥")
    print("\nüìä –û–∂–∏–¥–∞–µ–º—ã–µ –æ—Ç–≤–µ—Ç—ã:")
    print("‚Ä¢ '–ü–∏—Å–∞—Ç–µ–ª—å' ‚Üí '–•–µ–º–∏–Ω–≥—É—ç–π'")
    print("‚Ä¢ '–ü–æ—ç—Ç' ‚Üí '–®–µ–∫—Å–ø–∏—Ä'")
    print("‚Ä¢ '–ö–Ω–∏–≥–∞' ‚Üí '–¢—Ä–∏ —Ç–æ–≤–∞—Ä–∏—â–∞'")
    print("‚Ä¢ '–ú–æ–Ω–æ–ª–æ–≥' ‚Üí '–ë—ã—Ç—å –∏–ª–∏ –Ω–µ –±—ã—Ç—å'")
    print("=" * 50)

    app.run_polling(allowed_updates=Update.ALL_TYPES)


if __name__ == "__main__":
    main()